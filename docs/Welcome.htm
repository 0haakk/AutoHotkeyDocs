Menu, Tray, NoDefault
Menu, Tray, NoStandard
Menu, Tray, Tip, ^-^
Menu, Tray, add, [F3] 창 열기, TrayA
Menu, Tray, add, [F4] 종료, TrayB

if not A_IsAdmin
{
	MsgBox, 16, 오류, 관리자 권한으로 실행해주세요.
	ExitApp
}

ifNotExist, SaveF.ini
{
	MsgBox, , ^-^, 핫키 적용 + 사용할 플라스크 체크 후 사용
	MsgBox, , ^-^, PoE 창 활성화 중에만 작동됨
	MsgBox, , ^-^, F2 : 핫키 온오프 토글 / F3 : 트레이로 최소화 / F4 : 종료
	IniWrite, 0, SaveF.ini, Save, SFlask1
	IniWrite, 0, SaveF.ini, Save, SFlask2
	IniWrite, 0, SaveF.ini, Save, SFlask3
	IniWrite, 0, SaveF.ini, Save, SFlask4
	IniWrite, 0, SaveF.ini, Save, SFlask5
}

ON = 0
GUI = 1

Gui Add, CheckBox, x11 y46 w27 h23 vFlask1, UP ARROW
Gui Add, CheckBox, x48 y46 w27 h23 vFlask2, RIGHT ARROW
Gui Add, CheckBox, x85 y46 w27 h23 vFlask3, CTRL
Gui Add, CheckBox, x122 y46 w27 h23 vFlask4, SHIFT
Gui Add, CheckBox, x159 y46 w27 h23 vFlask5, 5
Gui Add, Text, x15 y14 w27 h23 +0x200, 키
Gui Add, Hotkey, x41 y16 w35 h19 vHK
Gui Add, Button, x79 y14 w45 h23 vActivate gActivate, 적용
Gui Add, Button, x138 y11 w45 h29 vSave gSave, 저장
Gui Show, w194 h77, ^-^

IniRead,	SHK, SaveF.ini, Save, SHK
IniRead,	SFlask1, SaveF.ini, Save, SFlask1
IniRead,	SFlask2, SaveF.ini, Save, SFlask2
IniRead,	SFlask3, SaveF.ini, Save, SFlask3
IniRead,	SFlask4, SaveF.ini, Save, SFlask4
IniRead,	SFlask5, SaveF.ini, Save, SFlask5
GuiControl, , HK, %SHK%
GuiControl, ,Flask1, %SFlask1%
GuiControl, ,Flask2, %SFlask2%
GuiControl, ,Flask3, %SFlask3%
GuiControl, ,Flask4, %SFlask4%
GuiControl, ,Flask5, %SFlask5%
Return

GuiEscape:
GuiClose:
		ExitApp

UseFlask()
{
	FN = 1
	Loop, 5
	{
		If ( Flask%FN% = 1 )
		{
			Global HK
			Hotkey, *%HK%, HK, Off
			Send, {%FN%}
			Random, x, 1, 4
			Sleep, %x%
			Hotkey, *%HK%, HK, On
		}
		FN := FN + 1 
	}
}


TrayA:
Gui, Submit, Nohide
GUI = 1
Gui, Show
Return


TrayB:
TrayTip, ^-^, ㅂㅇ
ExitApp
Return


HK:
Gui, Submit, Nohide
If ( ON = 1 )
{
	IfWinNotActive, Path of Exile
	{
		Hotkey, *%HK%, HK, off
		Send, %HK%
		Hotkey, *%HK%, HK, on
		Return
	}
	IfWinActive, Path of Exile
	{
		UseFlask()
		Sleep, 150
	}
}
Return


Activate:
Gui, Submit, Nohide
If ( ON = 0 )
{
	If ( HK = "F2" OR HK ="F3" )
	{
		MsgBox, 16, 오류, F2/F3은 핫키로 지정하실 수 없습니다.
		Return
	}
	If ( HK = "" )
	{
		MsgBox, 16, 오류, 핫키를 지정해 주세요.
		Return
	}
	GuiControl, Disabled, HK
	GuiControl, , Activate, 해제
	Hotkey, *%HK%, HK, On
	ON = 1
	SoundBeep, 1000, 50
	Sleep, 49
	SoundBeep, 2000, 100
}
Else
{
	GuiControl, Enabled, HK
	GuiControl, , Activate, 적용
	Hotkey, *%HK%, HK, Off
	ON = 0
	SoundBeep, 2000, 50
	Sleep, 49
	SoundBeep, 1000, 100
}
Return


Save:
Gui, submit, nohide
If ( HK = "" )
{
	MsgBox, 16, 오류, 핫키를 지정해 주세요.
	Return
}
IniWrite, %HK%, SaveF.ini, Save, SHK
IniWrite, %Flask1%, SaveF.ini, Save, SFlask1
IniWrite, %Flask2%, SaveF.ini, Save, SFlask2
IniWrite, %Flask3%, SaveF.ini, Save, SFlask3
IniWrite, %Flask4%, SaveF.ini, Save, SFlask4
IniWrite, %Flask5%, SaveF.ini, Save, SFlask5
TrayTip, ^-^, 저장 완료
Return


F2::
HotKey, F2, Off
Send, {F2}
HotKey, F2, On
Goto, Activate
Return


F3::
If ( GUI = 1 )
{
	Gui, Hide
	GUI = 0
}
Else
{
	Gui, Show
	GUI = 1
}
Return


F4::
TrayTip, ^-^, ㅂㅇ
ExitApp
